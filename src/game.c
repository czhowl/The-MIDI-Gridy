#include "game.h"
#include "ui.h"

uint8_t modeGame = 0;
uint8_t gameScale[] = {75,63,51,46,
                    76,64,52,47,
                    77,65,53,48,
                    78,66,54,49,
                    79,67,55,50,
                    80,68,56,51,
                    81,69,57,52,
                    82,70,58,53,
                    83,71,59,54,
                    84,72,60,55,
                    85,73,61,56,
                    86,74,62,57};
uint8_t gameInst[] = {41,41,41,43};
int gameN = 0;
uint64_t gameMask = 0x01;
uint64_t gameSwitch = 0;
uint8_t modeGamePause = 0;
uint8_t gameStart = 0;

gameNote gameTest[] ={//time, onOff, Pos
                    {0,1,19},
                    {992646,1,25},
                    {1097425,1,46},
                    {1101102,0,25},
                    {1207719,0,46},
                    {1210707,1,9},
                    {1262867,0,9},
                    {1266773,1,17},
                    {1323528,1,25},
                    {1324677,0,17},
                    {1428308,0,25},
                    {1436120,1,46},
                    {1538602,1,9},
                    {1542508,0,46},
                    {1593749,0,9},
                    {1598574,1,17},
                    {1615808,0,19},
                    {1654410,0,17},
                    {1654410,1,19},
                    {1655100,1,25},
                    {1759190,1,46},
                    {1764475,0,25},
                    {1869484,1,9},
                    {1873390,0,46},
                    {1924631,0,9},
                    {1928767,1,17},
                    {1979778,0,17},
                    {1985293,1,25},
                    {2090072,1,46},
                    {2094897,0,25},
                    {2200366,1,9},
                    {2203583,0,46},
                    {2255513,0,9},
                    {2259879,1,17},
                    {2281248,0,19},
                    {2314337,1,19},
                    {2316175,0,17},
                    {2316634,1,25},
                    {2420954,1,46},
                    {2424171,0,25},
                    {2531248,0,46},
                    {2534006,1,13},
                    {2586395,0,13},
                    {2593059,1,17},
                    {2641542,1,25},
                    {2647057,0,17},
                    {2751836,0,25},
                    {2755283,1,46},
                    {2862130,1,13},
                    {2867415,0,46},
                    {2917277,1,17},
                    {2920954,0,13},
                    {2942094,0,19},
                    {2972424,1,25},
                    {2976331,0,17},
                    {2978629,1,19},
                    {3082719,0,25},
                    {3086165,1,46},
                    {3193013,0,46},
                    {3197608,1,13},
                    {3248160,1,17},
                    {3255283,0,13},
                    {3303307,1,25},
                    {3308821,0,17},
                    {3413601,0,25},
                    {3419345,1,46},
                    {3523895,1,13},
                    {3530558,0,46},
                    {3579042,1,17},
                    {3584097,0,13},
                    {3607994,0,19},
                    {3634189,0,17},
                    {3634189,1,47},
                    {3639704,1,25},
                    {3640393,0,47},
                    {3954042,1,19},
                    {3971275,0,19},
                    {4246321,0,25},
                    {4284464,1,31},
                    {4303536,0,31},
                    {4358913,1,39},
                    {4358913,1,47},
                    {4410843,0,39},
                    {4414979,0,47},
                    {4621550,1,19},
                    {4632120,0,19},
                    {4842139,1,31},
                    {4855236,1,39},
                    {4906936,0,31},
                    {4910613,1,27},
                    {4961624,0,39},
                    {4963232,1,5},
                    {5068012,0,5},
                    {5073986,1,26},
                    {5178306,0,26},
                    {5184050,1,38},
                    {5233453,0,38},
                    {5239887,1,46},
                    {5294114,0,46},
                    {5295493,1,5},
                    {5398894,1,26},
                    {5402570,0,5},
                    {5509188,1,38},
                    {5512405,0,26},
                    {5564335,0,38},
                    {5568471,1,46},
                    {5619482,1,5},
                    {5624997,0,46},
                    {5729776,0,5},
                    {5735061,1,26},
                    {5840070,1,38},
                    {5846044,0,26},
                    {5895217,0,38},
                    {5902111,1,46},
                    {5950364,1,5},
                    {5957028,0,46},
                    {5957947,1,26},
                    {6065254,0,5},
                    {6066862,0,26},
                    {6109831,1,38},
                    {6176467,0,38},
                    {6215070,0,27},
                    {6275732,1,39},
                    {6286302,0,39},
                    {6600180,1,11},
                    {6619941,0,11},
                    {6933130,1,31},
                    {6949215,1,27},
                    {7002064,0,31},
                    {7004592,0,27},
                    {7056292,1,39},
                    {7056751,0,39},
                    {7267459,1,11},
                    {7280786,0,11},
                    {7610290,1,46},
                    {7610290,1,31},
                    {7610979,0,31},
                    {7665207,1,27},
                    {7676466,1,19},
                    {7715069,0,46},
                    {7719435,0,27},
                    {7721273,1,18},
                    {7825363,1,30},
                    {7831108,0,18},
                    {7880510,1,38},
                    {7884646,0,30},
                    {7935657,1,46},
                    {7939793,0,38},
                    {8045951,1,18},
                    {8050317,0,46},
                    {8156245,0,18},
                    {8161760,1,30},
                    {8211392,1,38},
                    {8217137,0,30},
                    {8266539,1,46},
                    {8272054,0,38},
                    {8376834,1,18},
                    {8380510,0,46},
                    {8487128,0,18},
                    {8491034,1,30},
                    {8542275,1,38},
                    {8545492,0,30},
                    {8597422,0,38},
                    {8600868,1,46},
                    {8602017,0,46},
                    {8711852,1,18},
                    {8714839,0,18},
                    {8759646,1,25},
                    {8862127,0,19},
                    {8928304,1,47},
                    {8932210,0,47},
                    {8933129,0,25},
                    {9247238,1,19},
                    {9247697,1,46},
                    {9263092,0,19},
                    {9266309,0,46},
                    {9576281,1,31},
                    {9581107,1,9},
                    {9595583,1,39},
                    {9597191,0,9},
                    {9649351,0,31},
                    {9651419,1,17},
                    {9651879,0,39},
                    {9653028,1,25},
                    {9703349,1,47},
                    {9705188,0,47},
                    {9705647,0,17},
                    {9707715,0,25},
                    {9914517,1,19},
                    {9916355,1,46},
                    {9924857,0,19},
                    {9926006,0,46},
                    {10133266,1,31},
                    {10134645,1,9},
                    {10147283,1,17},
                    {10147283,1,39},
                    {10201511,0,9},
                    {10202430,0,17},
                    {10202890,0,31},
                    {10257347,1,5},
                    {10257347,1,5},
                    {10257347,1,27},
                    {10257577,0,39},
                    {10362127,1,26},
                    {10367412,0,5},
                    {10472421,0,26},
                    {10477706,1,38},
                    {10527568,0,38},
                    {10534231,1,46},
                    {10582715,1,5},
                    {10588229,0,46},
                    {10693009,0,5},
                    {10697145,1,26},
                    {10803303,0,26},
                    {10809737,1,38},
                    {10858450,0,38},
                    {10863965,1,46},
                    {10913597,1,5},
                    {10919112,0,46},
                    {11023891,0,5},
                    {11029406,1,26},
                    {11134185,0,26},
                    {11139930,1,38},
                    {11189332,1,46},
                    {11195077,0,38},
                    {11244479,0,46},
                    {11250453,1,5},
                    {11252292,1,26},
                    {11359828,0,5},
                    {11362586,0,26},
                    {11403027,1,38},
                    {11472190,0,38},
                    {11509185,0,5},
                    {11509185,0,27},
                    {11569847,1,17},
                    {11569847,1,39},
                    {11582255,0,17},
                    {11583174,0,39},
                    {11895903,1,38},
                    {11897512,1,11},
                    {11910380,0,11},
                    {11910609,0,38},
                    {12224947,1,9},
                    {12225407,1,31},
                    {12243330,0,9},
                    {12244249,1,27},
                    {12297787,0,31},
                    {12298936,1,39},
                    {12299626,1,5},
                    {12299626,1,17},
                    {12351556,0,27},
                    {12352015,0,39},
                    {12352245,0,5},
                    {12353854,0,17},
                    {12561344,1,38},
                    {12562034,1,11},
                    {12572833,0,38},
                    {12574442,0,11},
                    {12893835,1,31},
                    {12904405,1,9},
                    {12904405,1,46},
                    {12904405,0,31},
                    {12906243,1,5},
                    {12956335,1,27},
                    {12960011,0,9},
                    {12970581,1,46},
                    {12970581,1,19},
                    {13009184,1,26},
                    {13013090,0,27},
                    {13013320,0,5},
                    {13014699,0,46},
                    {13119478,0,26},
                    {13125912,1,30},
                    {13174625,1,38},
                    {13180829,0,30},
                    {13229772,1,46},
                    {13235287,0,38},
                    {13340066,1,26},
                    {13343973,0,46},
                    {13450360,0,26},
                    {13453577,1,30},
                    {13505507,0,30},
                    {13510792,1,38},
                    {13566169,1,46},
                    {13567088,0,38},
                    {13670949,1,26},
                    {13675314,0,46},
                    {13781243,1,30},
                    {13785149,0,26},
                    {13836390,0,30},
                    {13840755,1,38},
                    {13891537,0,38},
                    {13894754,1,46},
                    {13897511,1,26},
                    {13963228,0,46},
                    {13963228,0,19},
                    {13996316,1,25},
                    {14005277,0,46},
                    {14007805,0,26},
                    {14029404,0,25},
                    {14049395,1,46},
                    {14090066,1,45},
                    {14090066,1,19},
                    {14118099,0,46},
                    {14156242,0,45},
                    {14156242,0,19},
                    {14162446,1,25},
                    {14216904,1,24},
                    {14216904,1,47},
                    {14227244,0,24},
                    {14228163,0,47},
                    {14332713,1,46},
                    {14336160,0,25},
                    {14443007,1,9},
                    {14446913,0,46},
                    {14498154,0,9},
                    {14501141,1,17},
                    {14541582,1,19},
                    {14542042,1,45},
                    {14553301,0,17},
                    {14556978,0,45},
                    {14558356,0,19},
                    {14558816,1,25},
                    {14663595,1,46},
                    {14669569,0,25},
                    {14773889,1,9},
                    {14779404,0,46},
                    {14829036,0,9},
                    {14833862,1,17},
                    {14870626,1,8},
                    {14872005,1,31},
                    {14888089,0,31},
                    {14889698,0,17},
                    {14890157,1,25},
                    {14891077,1,16},
                    {14942547,0,8},
                    {14943696,1,39},
                    {14943696,1,47},
                    {14947373,0,16},
                    {14994477,0,25},
                    {14997694,1,24},
                    {14997694,0,39},
                    {14998154,0,47},
                    {15001141,1,46},
                    {15002060,0,24},
                    {15104771,1,9},
                    {15111665,0,46},
                    {15159918,0,9},
                    {15166122,1,17},
                    {15207023,1,19},
                    {15211159,1,45},
                    {15215065,1,25},
                    {15218282,0,17},
                    {15221040,0,45},
                    {15221959,0,25},
                    {15222648,0,19},
                    {15328117,1,46},
                    {15333172,0,46},
                    {15429450,1,8},
                    {15431747,1,31},
                    {15436343,1,25},
                    {15439100,0,25},
                    {15441168,0,31},
                    {15442317,1,16},
                    {15495166,1,39},
                    {15495396,0,8},
                    {15497694,0,16},
                    {15498154,1,27},
                    {15550084,1,4},
                    {15551462,1,4},
                    {15551462,0,39},
                    {15656242,1,25},
                    {15659459,0,4},
                    {15766536,0,25},
                    {15768834,1,37},
                    {15821683,0,37},
                    {15825589,1,45},
                    {15876830,0,45},
                    {15881196,1,4},
                    {15987124,1,25},
                    {15990341,0,4},
                    {16097418,0,25},
                    {16101784,1,37},
                    {16152565,1,45},
                    {16157161,0,37},
                    {16213227,0,45},
                    {16213456,1,4},
                    {16318006,1,25},
                    {16325589,0,4},
                    {16428300,0,25},
                    {16434734,1,37},
                    {16483447,1,45},
                    {16487124,0,37},
                    {16538594,0,45},
                    {16541581,1,4},
                    {16542960,0,4},
                    {16653714,1,25},
                    {16653943,0,25},
                    {16703116,1,37},
                    {16763089,0,37},
                    {16803300,0,4},
                    {16803300,0,27},
                    {16812951,1,4},
                    {16863962,1,16},
                    {16863962,1,39},
                    {16873842,0,16},
                    {16876370,0,39},
                    {16979770,1,17},
                    {16983677,0,4},
                    {17090064,1,37},
                    {17093971,0,17},
                    {17145212,0,37},
                    {17149807,1,45},
                    {17187950,1,37},
                    {17191857,1,11},
                    {17200359,0,45},
                    {17204495,1,4},
                    {17204495,0,11},
                    {17206333,0,37},
                    {17310653,0,4},
                    {17314789,1,17},
                    {17420947,0,17},
                    {17425083,1,37},
                    {17476094,0,37},
                    {17479311,1,45},
                    {17519752,1,27},
                    {17520671,1,4},
                    {17531241,0,45},
                    {17536985,0,4},
                    {17537445,0,27},
                    {17537904,1,4},
                    {17538134,1,17},
                    {17646820,0,4},
                    {17648428,0,17},
                    {17686112,1,8},
                    {17686572,1,31},
                    {17700129,0,31},
                    {17700818,0,8},
                    {17749301,1,37},
                    {17757344,0,37},
                    {17848796,1,27},
                    {17849945,1,4},
                    {17861204,1,37},
                    {17868097,0,4},
                    {17868097,1,17},
                    {17868787,0,27},
                    {17978621,0,37},
                    {17978851,0,17},
                    {18016535,1,11},
                    {18016994,1,37},
                    {18031930,0,11},
                    {18034687,0,37},
                    {18082251,1,37},
                    {18090524,0,37},
                    {18183354,1,45},
                    {18198520,1,45},
                    {18198520,1,19},
                    {18303299,1,25},
                    {18308354,0,45},
                    {18413593,0,25},
                    {18419108,1,29},
                    {18468740,1,37},
                    {18474944,0,29},
                    {18523887,1,45},
                    {18529402,0,37},
                    {18634181,0,45},
                    {18636939,1,25},
                    {18727931,1,28},
                    {18744475,0,25},
                    {18748152,1,29},
                    {18794108,1,36},
                    {18799622,0,29},
                    {18803069,0,28},
                    {18803069,1,37},
                    {18854769,0,36},
                    {18854769,0,37},
                    {18854769,0,19},
                    {18858216,1,44},
                    {18858216,0,44},
                    {18858676,1,45},
                    {18965064,0,45},
                    {18969200,1,24},
                    {18969889,1,25},
                    {18971727,1,28},
                    {19075358,1,29},
                    {19079953,0,25},
                    {19080643,0,24},
                    {19082021,1,36},
                    {19130505,0,29},
                    {19133722,0,28},
                    {19135560,1,37},
                    {19136019,0,36},
                    {19185652,1,45},
                    {19188409,1,44},
                    {19191166,0,37},
                    {19192775,1,24},
                    {19290431,0,45},
                    {19299392,1,25},
                    {19299622,0,44},
                    {19302839,1,28},
                    {19389696,0,25},
                    {19408767,1,29},
                    {19409457,0,24},
                    {19410835,0,28},
                    {19455872,1,37},
                    {19463914,1,36},
                    {19465982,0,29},
                    {19467591,0,45},
                    {19469199,0,36},
                    {19516534,0,37}};

void gamePlay(void){
    gameCounter = DRV_TMR3_CounterValueGet();
    if((gameCounter%19516535 >= gameTest[gameN].time) && gameTest[gameN].onOff){
        gameSwitch |= gameMask << gameTest[gameN].pos;
        gameN++;
    }else if((gameCounter%19516535 >= gameTest[gameN].time) && !(gameTest[gameN].onOff)){
        gameSwitch &= ~(gameMask << gameTest[gameN].pos);
        gameN++;
    }
    if(gameN == 510){
        DRV_TMR3_Stop();
        DRV_TMR3_CounterClear();
        gameSwitch = 0;
        gameN = 0;
        gameStart = 0;
        lcdUpdateGame(menuGame);
    }
}

void gameClear(void){
    gameSwitch = 0;
    gameN = 0;
    modeGame = 0;
    gameMask = 0x01;
    modeGamePause = 0;
    gameStart = 0;
}